"use strict";

var playBtn = document.querySelector('.bonus__main-wheel-btn'),
    main = document.querySelector('.bonus__main'),
    chips = document.querySelectorAll('.bonus__chip'),
    popupChips = document.querySelectorAll('.bonus__overlay-chip'),
    firstWoman = document.querySelector('.bonus__overlay-firstWoman'),
    secondWoman = document.querySelector('.bonus__overlay-secondWoman'),
    wheel = document.querySelector('.bonus__main-wheel-reel'),
    overlay = document.querySelector('.bonus__overlay'),
    popupFirst = document.querySelector('.bonus__firstWin'),
    popupFirstBtn = document.querySelector('.bonus__firstWin-btn'),
    popupSecond = document.querySelector('.bonus__secondWin'),
    rules = document.querySelector('.bonus__rules'),
    footerRulesBtn = document.querySelector('.bonus__footer-rules'),
    overflow = document.querySelector('body'),
    popupClose = document.querySelector('.bonus__rules-close'),
    video = document.querySelector('.bonus__main-video-bg'),
    wrapper = document.querySelector('.bonus');
var bonusText = document.querySelector('.bonus__main-bubble');
var bonusLink = document.querySelector('.bonus__secondWin-btn');
var audioMain = document.querySelector('.main-audio');
var audioWheel = document.querySelector('.wheel-audio');
var audioPopup = document.querySelector('.popup-audio');
var clickAudio = document.querySelector('.click-audio');
audioMain.volume = 0.3;
audioWheel.volume = 0.2;
clickAudio.volume = 0.2;
window.onload = videoSource(video, 'img/video.mp4', 'video/mp4');

function videoSource(element, src, type) {
  if (window.innerWidth > 1024) {
    var source = document.createElement('source');
    source.src = src;
    source.type = type;
    video.appendChild(source);
  }
}

var triesCounter = 0;
footerRulesBtn.addEventListener('click', function () {
  clickAudio.play();
  overlay.classList.remove('opacity-overlay');
  rules.classList.remove('hide');
  main.classList.add('blur');
  chips.forEach(function (el) {
    el.classList.add('blur');
  });
  popupChips.forEach(function (el) {
    el.classList.add('hide');
  });
});
popupClose.addEventListener('click', function () {
  clickAudio.play();
  main.classList.remove('blur');
  overlay.classList.add('opacity-overlay');
  rules.classList.add('hide');
  overflow.style.overflow = 'unset';
  chips.forEach(function (el) {
    el.classList.remove('blur');
  });
});
playBtn.addEventListener('click', function () {
  if (triesCounter === 0) {
    runFirstRotation();
    audioMain.play();
  } else {
    runSecondRotation();
  }
});

function runFirstRotation() {
  wheel.classList.add('reel-rotation-first');
  playBtn.classList.remove('pulse-btn');
  playBtn.style.cursor = 'default';
  wrapper.style.pointerEvents = 'none';
  audioWheel.play();
  setTimeout(function () {
    doAfterFirstRotation();
  }, 6000);
  triesCounter++;
}

function doAfterFirstRotation() {
  wheel.style.transform = 'rotate(992deg)';
  wheel.classList.remove('reel-rotation-first');
  overlay.classList.add('win-tab');
  overlay.classList.add('win-mob');
  firstWoman.classList.remove('hide');
  displayPopup(popupFirst);
  wrapper.style.pointerEvents = 'auto';
  overflow.style.overflow = 'hidden';
  audioWheel.pause();
  audioPopup.play();
  setTimeout(function () {
    playBtn.classList.add('pulse-btn');
    playBtn.style.cursor = 'pointer';
    bonusText.style.display = "none";
  }, 1200);
}

function runSecondRotation() {
  wheel.classList.add('reel-rotation-second');
  playBtn.classList.remove('pulse-btn');
  playBtn.style.cursor = 'default';
  overflow.style.overflow = 'hidden';
  wrapper.style.pointerEvents = 'none';
  audioWheel.play();
  setTimeout(function () {
    doAfterSecondRotation();
  }, 6000);
  triesCounter++;
}

function doAfterSecondRotation() {
  overlay.classList.add('win-tab');
  overlay.classList.add('win-mob');
  secondWoman.classList.remove('hide');
  displayPopup(popupSecond);
  wrapper.style.pointerEvents = 'auto';
  audioWheel.pause();
  audioPopup.play();
}

bonusLink.addEventListener('click', function () {
  clickAudio.play();
});
popupFirstBtn.addEventListener('click', function () {
  clickAudio.play();
  main.classList.remove('blur');
  firstWoman.classList.add('hide');
  chips.forEach(function (el) {
    el.classList.remove('blur');
  });
  overlay.classList.add('opacity-overlay');
  popupFirst.classList.add('hide');
  overflow.style.overflow = 'unset';
  overlay.classList.remove('win-tab');
  overlay.classList.remove('win-mob');
});

function displayPopup(popup) {
  overlay.classList.remove('opacity-overlay');
  popup.classList.remove('hide');
  main.classList.add('blur');
  chips.forEach(function (el) {
    el.classList.add('blur');
  });
  popupChips.forEach(function (el) {
    el.classList.remove('hide');
  });
}

(function () {
  var url = new URL(window.location.href);
  var params = ['l', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'param1', 'param2'];
  var linkParams = ['affid', 'cpaid']; // ищем в url redirectUrl в url:

  if (url.searchParams.has('redirectUrl')) {
    var redirectUrl = new URL(url.searchParams.get('redirectUrl'));

    if (redirectUrl.href.match(/\//g).length === 4 && redirectUrl.searchParams.get('l')) {
      //если ссылка в ссылка redirectUrl корректная
      localStorage.setItem('redirectUrl', redirectUrl.href); // указываем точкой входа домен с протоколом из redirectUrl
    }
  } /////////


  params.forEach(function (param) {
    if (url.searchParams.has(param)) localStorage.setItem(param, url.searchParams.get(param));
  });
  linkParams.forEach(function (linkParam) {
    if (url.searchParams.has(linkParam)) localStorage.setItem(linkParam, url.searchParams.get(linkParam));
  });
  window.addEventListener('click', function (e) {
    var link,
        parent = e.target.closest('a');
    parent && (e.preventDefault(), localStorage.getItem("redirectUrl") ? link = new URL(localStorage.getItem("redirectUrl")) : (link = new URL(parent.href), affid = localStorage.getItem('affid'), cpaid = localStorage.getItem('cpaid'), affid && cpaid && (link.pathname = '/' + affid + '/' + cpaid)), params.forEach(function (param) {
      url.searchParams.has(param) && link.searchParams.set(param, localStorage.getItem(param));
    }), document.location.href = link);
  });
})();
"use strict";
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJzZWNvbmQuanMiXSwibmFtZXMiOlsicGxheUJ0biIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1haW4iLCJjaGlwcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJwb3B1cENoaXBzIiwiZmlyc3RXb21hbiIsInNlY29uZFdvbWFuIiwid2hlZWwiLCJvdmVybGF5IiwicG9wdXBGaXJzdCIsInBvcHVwRmlyc3RCdG4iLCJwb3B1cFNlY29uZCIsInJ1bGVzIiwiZm9vdGVyUnVsZXNCdG4iLCJvdmVyZmxvdyIsInBvcHVwQ2xvc2UiLCJ2aWRlbyIsIndyYXBwZXIiLCJib251c1RleHQiLCJib251c0xpbmsiLCJhdWRpb01haW4iLCJhdWRpb1doZWVsIiwiYXVkaW9Qb3B1cCIsImNsaWNrQXVkaW8iLCJ2b2x1bWUiLCJ3aW5kb3ciLCJvbmxvYWQiLCJ2aWRlb1NvdXJjZSIsImVsZW1lbnQiLCJzcmMiLCJ0eXBlIiwiaW5uZXJXaWR0aCIsInNvdXJjZSIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInRyaWVzQ291bnRlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJwbGF5IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwiZm9yRWFjaCIsImVsIiwic3R5bGUiLCJydW5GaXJzdFJvdGF0aW9uIiwicnVuU2Vjb25kUm90YXRpb24iLCJjdXJzb3IiLCJwb2ludGVyRXZlbnRzIiwic2V0VGltZW91dCIsImRvQWZ0ZXJGaXJzdFJvdGF0aW9uIiwidHJhbnNmb3JtIiwiZGlzcGxheVBvcHVwIiwicGF1c2UiLCJkaXNwbGF5IiwiZG9BZnRlclNlY29uZFJvdGF0aW9uIiwicG9wdXAiLCJ1cmwiLCJVUkwiLCJsb2NhdGlvbiIsImhyZWYiLCJwYXJhbXMiLCJsaW5rUGFyYW1zIiwic2VhcmNoUGFyYW1zIiwiaGFzIiwicmVkaXJlY3RVcmwiLCJnZXQiLCJtYXRjaCIsImxlbmd0aCIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJwYXJhbSIsImxpbmtQYXJhbSIsImUiLCJsaW5rIiwicGFyZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsInByZXZlbnREZWZhdWx0IiwiZ2V0SXRlbSIsImFmZmlkIiwiY3BhaWQiLCJwYXRobmFtZSIsInNldCJdLCJtYXBwaW5ncyI6Ijs7QUFDQSxJQUFNQSxPQUFPLEdBQUdDLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1Qix3QkFBdkIsQ0FBaEI7QUFBQSxJQUNNQyxJQUFJLEdBQUdGLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixjQUF2QixDQURiO0FBQUEsSUFFTUUsS0FBSyxHQUFHSCxRQUFRLENBQUNJLGdCQUFULENBQTBCLGNBQTFCLENBRmQ7QUFBQSxJQUdNQyxVQUFVLEdBQUdMLFFBQVEsQ0FBQ0ksZ0JBQVQsQ0FBMEIsc0JBQTFCLENBSG5CO0FBQUEsSUFJTUUsVUFBVSxHQUFHTixRQUFRLENBQUNDLGFBQVQsQ0FBdUIsNEJBQXZCLENBSm5CO0FBQUEsSUFLTU0sV0FBVyxHQUFHUCxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsNkJBQXZCLENBTHBCO0FBQUEsSUFNTU8sS0FBSyxHQUFHUixRQUFRLENBQUNDLGFBQVQsQ0FBdUIseUJBQXZCLENBTmQ7QUFBQSxJQU9NUSxPQUFPLEdBQUdULFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixpQkFBdkIsQ0FQaEI7QUFBQSxJQVFNUyxVQUFVLEdBQUdWLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixrQkFBdkIsQ0FSbkI7QUFBQSxJQVNNVSxhQUFhLEdBQUdYLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixzQkFBdkIsQ0FUdEI7QUFBQSxJQVVNVyxXQUFXLEdBQUdaLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixtQkFBdkIsQ0FWcEI7QUFBQSxJQVdNWSxLQUFLLEdBQUdiLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixlQUF2QixDQVhkO0FBQUEsSUFZTWEsY0FBYyxHQUFHZCxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsc0JBQXZCLENBWnZCO0FBQUEsSUFhTWMsUUFBUSxHQUFHZixRQUFRLENBQUNDLGFBQVQsQ0FB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K0JHLElBQUksQ0FBQ1gsWUFBTCxDQUFrQm9CLEdBQWxCLENBQXNCWixLQUF0QixFQUE2QkYsWUFBWSxDQUFDVSxPQUFiLENBQXFCUixLQUFyQixDQUE3QixDQUEvQjtJQUNILENBRkQsQ0FWQSxFQWFEdkUsUUFBUSxDQUFDMkQsUUFBVCxDQUFrQkMsSUFBbEIsR0FBeUJjLElBZHRCLENBQU47RUFlSCxDQWpCRDtBQWtCSCxDQXRERDtBQ25LQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5jb25zdCBwbGF5QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvbnVzX19tYWluLXdoZWVsLWJ0bicpLFxuICAgICAgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fbWFpbicpLFxuICAgICAgY2hpcHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm9udXNfX2NoaXAnKSxcbiAgICAgIHBvcHVwQ2hpcHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm9udXNfX292ZXJsYXktY2hpcCcpLFxuICAgICAgZmlyc3RXb21hbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fb3ZlcmxheS1maXJzdFdvbWFuJyksXG4gICAgICBzZWNvbmRXb21hbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fb3ZlcmxheS1zZWNvbmRXb21hbicpLFxuICAgICAgd2hlZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX21haW4td2hlZWwtcmVlbCcpLFxuICAgICAgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fb3ZlcmxheScpLFxuICAgICAgcG9wdXBGaXJzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fZmlyc3RXaW4nKSxcbiAgICAgIHBvcHVwRmlyc3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX2ZpcnN0V2luLWJ0bicpLFxuICAgICAgcG9wdXBTZWNvbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX3NlY29uZFdpbicpLFxuICAgICAgcnVsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX3J1bGVzJyksXG4gICAgICBmb290ZXJSdWxlc0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fZm9vdGVyLXJ1bGVzJyksXG4gICAgICBvdmVyZmxvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKSxcbiAgICAgIHBvcHVwQ2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX3J1bGVzLWNsb3NlJyksXG4gICAgICB2aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fbWFpbi12aWRlby1iZycpLFxuICAgICAgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251cycpXG5cblxuY29uc3QgYm9udXNUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvbnVzX19tYWluLWJ1YmJsZScpO1xuY29uc3QgYm9udXNMaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvbnVzX19zZWNvbmRXaW4tYnRuJyk7XG5jb25zdCBhdWRpb01haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFpbi1hdWRpbycpO1xuY29uc3QgYXVkaW9XaGVlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aGVlbC1hdWRpbycpO1xuY29uc3QgYXVkaW9Qb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1hdWRpbycpO1xuY29uc3QgY2xpY2tBdWRpbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbGljay1hdWRpbycpO1xuYXVkaW9NYWluLnZvbHVtZSA9IDAuMztcbmF1ZGlvV2hlZWwudm9sdW1lID0gMC4yO1xuY2xpY2tBdWRpby52b2x1bWUgPSAwLjI7XG5cbndpbmRvdy5vbmxvYWQgPSB2aWRlb1NvdXJjZSh2aWRlbywgJ2ltZy92aWRlby5tcDQnLCAndmlkZW8vbXA0Jyk7XG5cblxuZnVuY3Rpb24gdmlkZW9Tb3VyY2UoZWxlbWVudCwgc3JjLCB0eXBlKSB7XG4gICAgaWYod2luZG93LmlubmVyV2lkdGggPiAxMDI0KSB7XG4gICAgICAgIGxldCBzb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKVxuICAgICAgICBzb3VyY2Uuc3JjID0gc3JjXG4gICAgICAgIHNvdXJjZS50eXBlID0gdHlwZVxuICAgICAgICB2aWRlby5hcHBlbmRDaGlsZChzb3VyY2UpXG4gICAgfVxufVxuXG5sZXQgdHJpZXNDb3VudGVyID0gMFxuXG5mb290ZXJSdWxlc0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBjbGlja0F1ZGlvLnBsYXkoKVxuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eS1vdmVybGF5JylcbiAgICBydWxlcy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJylcbiAgICBtYWluLmNsYXNzTGlzdC5hZGQoJ2JsdXInKVxuICAgIGNoaXBzLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2JsdXInKVxuICAgIH0pXG4gICAgcG9wdXBDaGlwcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdoaWRlJylcbiAgICB9KVxufSlcblxucG9wdXBDbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBjbGlja0F1ZGlvLnBsYXkoKVxuICAgIG1haW4uY2xhc3NMaXN0LnJlbW92ZSgnYmx1cicpXG4gICAgb3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdvcGFjaXR5LW92ZXJsYXknKVxuICAgIHJ1bGVzLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKVxuICAgIG92ZXJmbG93LnN0eWxlLm92ZXJmbG93ID0gJ3Vuc2V0J1xuICAgIGNoaXBzLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2JsdXInKVxuICAgIH0pXG59KVxuXG5wbGF5QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXG4gICAgaWYgKHRyaWVzQ291bnRlciA9PT0gMCkge1xuICAgICAgICBydW5GaXJzdFJvdGF0aW9uKClcbiAgICAgICAgYXVkaW9NYWluLnBsYXkoKVxuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgcnVuU2Vjb25kUm90YXRpb24oKVxuICAgIH1cbn0pXG5cbmZ1bmN0aW9uIHJ1bkZpcnN0Um90YXRpb24oKSB7XG4gICAgd2hlZWwuY2xhc3NMaXN0LmFkZCgncmVlbC1yb3RhdGlvbi1maXJzdCcpXG4gICAgcGxheUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdwdWxzZS1idG4nKVxuICAgIHBsYXlCdG4uc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnXG4gICAgd3JhcHBlci5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnXG4gICAgYXVkaW9XaGVlbC5wbGF5KClcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgZG9BZnRlckZpcnN0Um90YXRpb24oKVxuICAgIH0sIDYwMDApXG4gICAgdHJpZXNDb3VudGVyKytcbn1cblxuZnVuY3Rpb24gZG9BZnRlckZpcnN0Um90YXRpb24oKSB7XG4gICAgd2hlZWwuc3R5bGUudHJhbnNmb3JtID0gJ3JvdGF0ZSg5OTJkZWcpJ1xuICAgIHdoZWVsLmNsYXNzTGlzdC5yZW1vdmUoJ3JlZWwtcm90YXRpb24tZmlyc3QnKVxuICAgIG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnd2luLXRhYicpXG4gICAgb3ZlcmxheS5jbGFzc0xpc3QuYWRkKCd3aW4tbW9iJylcbiAgICBmaXJzdFdvbWFuLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKVxuICAgIGRpc3BsYXlQb3B1cChwb3B1cEZpcnN0KVxuICAgIHdyYXBwZXIuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJ1xuICAgIG92ZXJmbG93LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbidcblxuICAgIGF1ZGlvV2hlZWwucGF1c2UoKVxuICAgIGF1ZGlvUG9wdXAucGxheSgpXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHBsYXlCdG4uY2xhc3NMaXN0LmFkZCgncHVsc2UtYnRuJylcbiAgICAgICAgcGxheUJ0bi5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcidcbiAgICAgICAgYm9udXNUZXh0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxuICAgIH0sIDEyMDApXG59XG5cbmZ1bmN0aW9uIHJ1blNlY29uZFJvdGF0aW9uKCkge1xuICAgIHdoZWVsLmNsYXNzTGlzdC5hZGQoJ3JlZWwtcm90YXRpb24tc2Vjb25kJylcbiAgICBwbGF5QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3B1bHNlLWJ0bicpXG4gICAgcGxheUJ0bi5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCdcbiAgICBvdmVyZmxvdy5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nXG4gICAgd3JhcHBlci5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnXG4gICAgYXVkaW9XaGVlbC5wbGF5KClcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgZG9BZnRlclNlY29uZFJvdGF0aW9uKClcbiAgICB9LCA2MDAwKVxuICAgIHRyaWVzQ291bnRlcisrXG59XG5cbmZ1bmN0aW9uIGRvQWZ0ZXJTZWNvbmRSb3RhdGlvbigpIHtcbiAgICBvdmVybGF5LmNsYXNzTGlzdC5hZGQoJ3dpbi10YWInKVxuICAgIG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnd2luLW1vYicpXG4gICAgc2Vjb25kV29tYW4uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpXG4gICAgZGlzcGxheVBvcHVwKHBvcHVwU2Vjb25kKVxuICAgIHdyYXBwZXIuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJ1xuICAgIGF1ZGlvV2hlZWwucGF1c2UoKVxuICAgIGF1ZGlvUG9wdXAucGxheSgpXG59XG5cbmJvbnVzTGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBjbGlja0F1ZGlvLnBsYXkoKTtcbn0pXG5cbnBvcHVwRmlyc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgY2xpY2tBdWRpby5wbGF5KClcbiAgICBtYWluLmNsYXNzTGlzdC5yZW1vdmUoJ2JsdXInKVxuICAgIGZpcnN0V29tYW4uY2xhc3NMaXN0LmFkZCgnaGlkZScpXG4gICAgY2hpcHMuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnYmx1cicpXG4gICAgfSlcbiAgICBvdmVybGF5LmNsYXNzTGlzdC5hZGQoJ29wYWNpdHktb3ZlcmxheScpXG4gICAgcG9wdXBGaXJzdC5jbGFzc0xpc3QuYWRkKCdoaWRlJylcbiAgICBvdmVyZmxvdy5zdHlsZS5vdmVyZmxvdyA9ICd1bnNldCdcbiAgICBvdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ3dpbi10YWInKVxuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnd2luLW1vYicpXG59KVxuXG5mdW5jdGlvbiBkaXNwbGF5UG9wdXAocG9wdXApIHtcbiAgICBvdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ29wYWNpdHktb3ZlcmxheScpXG4gICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpXG4gICAgbWFpbi5jbGFzc0xpc3QuYWRkKCdibHVyJylcbiAgICBjaGlwcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdibHVyJylcbiAgICB9KVxuICAgIHBvcHVwQ2hpcHMuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpXG4gICAgfSlcbn1cblxuKGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgdXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24uaHJlZilcblxuICAgIGNvbnN0IHBhcmFtcyA9IFtcbiAgICAgICAgJ2wnLFxuICAgICAgICAndXRtX3NvdXJjZScsXG4gICAgICAgICd1dG1fbWVkaXVtJyxcbiAgICAgICAgJ3V0bV9jYW1wYWlnbicsXG4gICAgICAgICd1dG1fdGVybScsXG4gICAgICAgICd1dG1fY29udGVudCcsXG4gICAgICAgICdwYXJhbTEnLFxuICAgICAgICAncGFyYW0yJ1xuICAgIF1cblxuICAgIGNvbnN0IGxpbmtQYXJhbXMgPSBbXG4gICAgICAgICdhZmZpZCcsXG4gICAgICAgICdjcGFpZCdcbiAgICBdXG5cbiAgICAvLyDQuNGJ0LXQvCDQsiB1cmwgcmVkaXJlY3RVcmwg0LIgdXJsOlxuICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcygncmVkaXJlY3RVcmwnKSkge1xuICAgICAgICB2YXIgcmVkaXJlY3RVcmwgPSBuZXcgVVJMKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdyZWRpcmVjdFVybCcpKTtcbiAgICAgICAgaWYgKHJlZGlyZWN0VXJsLmhyZWYubWF0Y2goL1xcLy9nKS5sZW5ndGggPT09IDQgJiYgcmVkaXJlY3RVcmwuc2VhcmNoUGFyYW1zLmdldCgnbCcpKSB7IC8v0LXRgdC70Lgg0YHRgdGL0LvQutCwINCyINGB0YHRi9C70LrQsCByZWRpcmVjdFVybCDQutC+0YDRgNC10LrRgtC90LDRj1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlZGlyZWN0VXJsJywgcmVkaXJlY3RVcmwuaHJlZik7IC8vINGD0LrQsNC30YvQstCw0LXQvCDRgtC+0YfQutC+0Lkg0LLRhdC+0LTQsCDQtNC+0LzQtdC9INGBINC/0YDQvtGC0L7QutC+0LvQvtC8INC40LcgcmVkaXJlY3RVcmxcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLy8vLy8vLy9cblxuICAgIHBhcmFtcy5mb3JFYWNoKChwYXJhbSkgPT4ge1xuICAgICAgICBpZiAodXJsLnNlYXJjaFBhcmFtcy5oYXMocGFyYW0pKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShwYXJhbSwgdXJsLnNlYXJjaFBhcmFtcy5nZXQocGFyYW0pKVxuICAgIH0pXG5cbiAgICBsaW5rUGFyYW1zLmZvckVhY2goKGxpbmtQYXJhbSkgPT4ge1xuICAgICAgICBpZiAodXJsLnNlYXJjaFBhcmFtcy5oYXMobGlua1BhcmFtKSkgbG9jYWxTdG9yYWdlLnNldEl0ZW0obGlua1BhcmFtLCB1cmwuc2VhcmNoUGFyYW1zLmdldChsaW5rUGFyYW0pKVxuICAgIH0pXG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgbGluaywgcGFyZW50ID0gZS50YXJnZXQuY2xvc2VzdCgnYScpXG4gICAgICAgIHBhcmVudCAmJiAoXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCksXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInJlZGlyZWN0VXJsXCIpID9cbiAgICAgICAgICAgIGxpbmsgPSBuZXcgVVJMKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicmVkaXJlY3RVcmxcIikpXG4gICAgICAgICAgICA6IChcbiAgICAgICAgICAgICAgICBsaW5rID0gbmV3IFVSTChwYXJlbnQuaHJlZiksXG4gICAgICAgICAgICAgICAgYWZmaWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWZmaWQnKSxcbiAgICAgICAgICAgICAgICBjcGFpZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjcGFpZCcpLFxuICAgICAgICAgICAgICAgIGFmZmlkICYmIGNwYWlkICYmIChsaW5rLnBhdGhuYW1lID0gJy8nICsgYWZmaWQgKyAnLycgKyBjcGFpZClcbiAgICAgICAgICAgICAgICApLFxuXG4gICAgICAgICAgICBwYXJhbXMuZm9yRWFjaCgocGFyYW0pID0+IHtcbiAgICAgICAgICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLmhhcyhwYXJhbSkgJiYgbGluay5zZWFyY2hQYXJhbXMuc2V0KHBhcmFtLCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShwYXJhbSkpXG4gICAgICAgICAgICB9XG4gICAgICAgICksIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSBsaW5rKVxuICAgIH0pXG59KSgpIiwiIl19
